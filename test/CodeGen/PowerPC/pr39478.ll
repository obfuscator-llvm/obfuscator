; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple=powerpc64le-unknown-unknown -verify-machineinstrs < %s | \
; RUN:   FileCheck %s
; RUN: llc -mtriple=powerpc64-unknown-unknown -verify-machineinstrs < %s | \
; RUN:   FileCheck %s

define void @pr39478() {
; CHECK-LABEL: pr39478:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    lwz 3, 0(3)
; CHECK-NEXT:    stb 3, 0(3)
; CHECK-NEXT:    blr
entry:
  %tmp32 = load i64, i64* undef, align 8
  %tmp33 = load i32, i32* undef, align 4
  %tmp34 = and i32 %tmp33, -256
  %tmp35 = lshr i64 %tmp32, 32
  %tmp36 = shl nuw nsw i64 %tmp35, 24
  %tmp37 = trunc i64 %tmp36 to i32
  %tmp38 = call i32 @llvm.bswap.i32(i32 %tmp37)
  %tmp39 = or i32 %tmp38, %tmp34
  store i32 %tmp39, i32* undef, align 4
  ret void
}

declare i32 @llvm.bswap.i32(i32)
